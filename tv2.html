<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Video Player</title>
    <style type="text/css" media="screen">
        body {
            background-color: #000;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        #player {
            width: 100vw;
            height: 100vh;
        }
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
        }
    </style>
</head>
<body>
    <div id="player"></div>
    <div id="loading">Loading player...</div>

    <!-- Required scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@clappr/player@0.8/dist/clappr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@swarmcloud/hls/p2p-engine.min.js"></script>
    <script src="https://cdn.jsdelivr.net/clappr.level-selector/latest/level-selector.min.js"></script>

    <script>
        // Configuration
        var p2pConfig = {
            swFile: 'sw.js',
            live: true,
            trackerZone: 'eu',
            token: "TVdxQdDHg",
            hlsjsConfig: {
                maxMaxBufferLength: 100,
                xhrSetup: function(xhr, url) {
                    xhr.withCredentials = false;
                }
            }
        };

        // Initialize player
        var player = new Clappr.Player({
            parentId: "#player",
            height: "100%",
            width: "100%",
            mediacontrol: {
                seekbar: "#FF0000",
                buttons: "#FF0000"
            },
            autoPlay: true,
            plugins: [LevelSelector]
        });

        // Initialize P2P and load stream
        P2PEngineHls.tryRegisterServiceWorker(p2pConfig).then(() => {
            player.load({
                source: 'https://abcc.yallashooot.store:8181/dnaz/index.m3u8',
                mimeType: 'application/vnd.apple.mpegurl'
            });
            
            p2pConfig.hlsjsInstance = player.core.getCurrentPlayback()._hls;
            var engine = new P2PEngineHls(p2pConfig);
        });

        // Hide loading indicator after 3 seconds
        setTimeout(function() {
            document.getElementById('loading').style.display = 'none';
        }, 3000);

        // Error handling
        player.on(Clappr.Events.ERROR, function(error) {
            console.error('Player error:', error);
        });
    </script>
</body>
</html>